!function(t){"use strict";window.minimog=window.minimog||{};var o=t("body"),n=t("#popup-fly-cart"),i=window.minimog.Helpers;minimog.WC_Coupon={init:function(){var i=this;t(document).on("submit",".form-coupon",function(o){var n=t(this),e=n.find('input[name="coupon_code"]').val();return n.closest(".minimog-modal").MinimogModal("close"),i.apply_coupon(e),!1}),t(document).on("click",".apply-coupon-link",function(o){o.preventDefault();var o=t(this);if(!o.hasClass("coupon-selected")&&!o.hasClass("coupon-disabled"))return o=o.closest(".minimog-modal"),t.fn.MinimogModal&&0<o.length&&o.MinimogModal("close"),o=t(this).attr("data-coupon"),i.apply_coupon(o),!1}),t(document).on("click",".remove-coupon-link",{WC_Coupon:i},i.remove_coupon)},apply_coupon:function(n){var o=this;if(""===n)return!1;var e={coupon_code:n,security:$minimogWoo.apply_coupon_nonce};t.ajax({type:"POST",url:$minimogWoo.wc_ajax_url.toString().replace("%%endpoint%%","minimog_apply_coupon"),data:e,dataType:"json",success:function(o){o.data&&o.data.fragments&&t.each(o.data.fragments,function(o,n){t(o).replaceWith(n)}),$minimogWoo.is_checkout?(t(document.body).trigger("applied_coupon_in_checkout",[n]),t(document.body).trigger("update_checkout",{update_shipping_method:!1})):t(document.body).trigger("applied_coupon",[n])},beforeSend:function(){o.is_fly_cart_opening()?(o.close_fly_cart_modal(),o.block_loading()):i.setBodyHandling()},complete:function(){o.is_fly_cart_opening()?o.unblock_loading():i.setBodyCompleted()}})},remove_coupon:function(o){o.preventDefault();var n=o.data.WC_Coupon,e=t(this).attr("data-coupon"),o={coupon_code:e,security:$minimogWoo.remove_coupon_nonce};t.ajax({type:"POST",url:$minimogWoo.wc_ajax_url.toString().replace("%%endpoint%%","minimog_remove_coupon"),data:o,dataType:"json",success:function(o){o.data&&o.data.fragments&&t.each(o.data.fragments,function(o,n){t(o).replaceWith(n)}),$minimogWoo.is_checkout?(t(document.body).trigger("removed_coupon_in_checkout",[e]),t(document.body).trigger("update_checkout",{update_shipping_method:!1})):t(document.body).trigger("removed_coupon",[e])},beforeSend:function(){n.is_fly_cart_opening()?n.block_loading():i.setBodyHandling()},complete:function(){n.is_fly_cart_opening()?n.unblock_loading():i.setBodyCompleted()}})},block_loading:function(){n.find(".fly-cart-messages").slideUp(300,function(){n.find(".fly-cart-messages").empty()}),n.removeClass("loaded").addClass("loading")},unblock_loading:function(){n.removeClass("loading").addClass("loaded")},is_fly_cart_opening:function(){return o.hasClass("popup-fly-cart-opened")},close_fly_cart_modal:function(){n.find(".fly-cart-addon-modal").removeClass("open"),n.removeClass("modal-open")}},t(document).ready(function(){minimog.WC_Coupon.init()})}(jQuery);