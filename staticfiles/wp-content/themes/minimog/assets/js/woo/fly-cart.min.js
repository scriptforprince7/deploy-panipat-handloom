!function(i){"use strict";var t=i("body"),r=i("#popup-fly-cart"),e="popup-fly-cart-opened",o=window.minimog.Helpers;function a(e){var t;"undefined"!=typeof wc_add_to_cart_params&&(e.preventDefault(),t=i(this),i.ajax({type:"POST",url:$minimogWoo.wc_ajax_url.toString().replace("%%endpoint%%","remove_from_cart"),data:{cart_item_key:t.data("cart_item_key")},dataType:"json",beforeSend:function(){u()},success:function(e){e&&e.fragments?(i(document.body).trigger("removed_from_cart",[e.fragments,e.cart_hash,t]),f()):window.location=t.attr("href")},error:function(){window.location=t.attr("href")}}))}function n(){var e=i(this).find("button[type=submit]"),t=i(this).find('textarea[name="order_comments"]').val(),a={order_notes:t};return i.ajax({type:"POST",url:$minimogWoo.wc_ajax_url.toString().replace("%%endpoint%%","minimog_save_order_notes"),data:a,dataType:"json",success:function(e){e.data&&e.data.fragments&&i.each(e.data.fragments,function(e,t){i(e).replaceWith(t)}),i('textarea[name="order_comments"]').val(t)},beforeSend:function(){o.setElementHandling(e)},complete:function(){o.unsetElementHandling(e),l()}}),!1}function c(){o.setBodyOverflow(),t.addClass(e),i.fn.perfectScrollbar&&!o.isHandheld()&&setTimeout(function(){r.find(".fly-cart-wrap").perfectScrollbar()},100),o.handleLazyImages(r),m(),r.hasClass("opened")||i(document.body).trigger("minimog_fly_cart_first_open",[r]),r.addClass("opened")}function d(){o.unsetBodyOverflow(),t.removeClass(e)}function s(){return!!t.hasClass(e)}function l(){r.find(".fly-cart-addon-modal").removeClass("open"),r.removeClass("modal-open")}function m(){var e=r.offset().top,t=r.find(".fly-cart-header"),a=r.find(".fly-cart-body"),n=r.find(".fly-cart-footer"),t=window.innerHeight-t.outerHeight()-n.outerHeight()-20-e,t=Math.max(t,400);a.outerHeight(t),i.fn.perfectScrollbar&&!o.isHandheld()&&a.perfectScrollbar({wheelPropagation:!0})}function u(){r.find(".fly-cart-messages").slideUp(300,function(){r.find(".fly-cart-messages").empty()}),r.removeClass("loaded").addClass("loading")}function f(){r.removeClass("loading").addClass("loaded")}function p(){var e={},t=(i(this).closest(".woocommerce-shipping-methods").find("select.shipping_method, :input[name^=shipping_method][type=radio]:checked, :input[name^=shipping_method][type=hidden]").each(function(){e[i(this).data("index")]=i(this).val()}),{security:$minimog.nonce,shipping_method:e});i.ajax({type:"POST",url:$minimogWoo.wc_ajax_url.toString().replace("%%endpoint%%","minimog_update_shipping_method"),data:t,dataType:"json",success:function(e){e.data&&e.data.fragments&&i.each(e.data.fragments,function(e,t){i(e).replaceWith(t)})},beforeSend:function(){s()?u():o.setBodyHandling()},complete:function(){s()?f():o.setBodyCompleted(),i(document.body).trigger("updated_shipping_method")}})}function g(e){e.preventDefault(),l(),u();e=i(e.currentTarget);i.ajax({type:e.attr("method"),url:$minimogWoo.wc_ajax_url.toString().replace("%%endpoint%%","minimog_calculate_shipping"),data:e.serialize(),dataType:"json",success:function(e){e.data.fragments&&i.each(e.data.fragments,function(e,t){i(e).empty(),""!==t&&(t=i(i.parseHTML(t)),i(e).html(t.html()))})},complete:function(){f()}})}function h(){var e=i(".cart-data-info").first();0<e.length&&((e=e.data("value")).count<=0?t.addClass("cart-is-empty"):t.removeClass("cart-is-empty"),"number"==typeof e.free_shipping_class_only&&1===e.free_shipping_class_only?t.addClass("cart-includes-only-free-shipping-class"):t.removeClass("cart-includes-only-free-shipping-class")),i(".cart-goal-percent").each(function(){var e=i(this).closest(".cart-goal"),t=e.find(".cart-goal-progress .progress-bar"),a=parseFloat(i(this).val());setTimeout(function(){t.css({width:a+"%"}),a<100?e.removeClass("cart-goal-done shakeY"):e.addClass("cart-goal-done shakeY")},300)})}function _(){var o,e=i(".cart-data-info").first();e.length<=0||!i.fn.MinimogCountdownTimer||(o=e.data("value"),i(".cart-countdown-timer").each(function(){var e=i(this),t=e.find(".timer"),a=e.data("countdown"),n=Date.now(),n={startTime:n,endTime:n+60*a.length*1e3,addZeroPrefix:!0,formatter:a.formatter,loop:a.loop,callback:()=>{e.find(".cart-countdown-message").text(a.expired_message)}};if(o.count<=0)return t.MinimogCountdownTimer(n),t.MinimogCountdownTimer("clear"),!0;t.MinimogCountdownTimer(n)}))}i(document).ready(function(){var e;i(document.body).on("click",".mini-cart__button",function(e){0<r.length&&(e.preventDefault(),c())}),t.on("added_to_cart",function(e,t,a,n){var o;void 0!==n&&(0<(o=n.closest(".modal-quick-view-popup")).length&&i.fn.MinimogModal&&o.MinimogModal("close"),0<(o=n.closest("#woosw_wishlist")).length&&(o.removeClass("woosw-show"),i(document.body).trigger("woosw_wishlist_hide")),0<r.length)&&"open_cart_drawer"===$minimogWoo.add_to_cart_behaviour&&c()}),i("#btn-close-fly-cart").on("click",function(e){e.preventDefault(),d()}),r.on("click",function(e){e.target===this&&d()}),i(document).on("click",".fly-cart-addon-modal-toggle",function(e){e.preventDefault();var e=i(this).data("target"),t=i(e);0<t.length&&(e=t.data("minimog-template"),!t.hasClass("template-loaded")&&e?i.ajax({url:o.getAjaxUrl("template_lazyload"),type:"GET",data:{template:e,context:"wc_cart"},dataType:"json",cache:!1,success:function(e){e.success&&(t.html(e.data.template),t.hasClass("modal-shipping-calculator")&&i(document.body).trigger("country_to_state_changed"),r.addClass("modal-open"),t.addClass("open"),t.addClass("template-loaded"))},beforeSend:function(){u()},complete:function(){f()}}):(r.addClass("modal-open"),t.addClass("open")))}),r.on("click",".btn-close-fly-cart-modal",function(e){e.preventDefault(),l()}),r.on("click",".js-remove-from-cart",a),r.on("change",".qty",function(){var o=i(this);o.get(0).reportValidity()&&(void 0!==e&&clearTimeout(e),e=setTimeout(function(){var t,a,e=o.attr("name"),n=o.val();e={cart_item_key:t=e,cart_item_qty:a=n,security:$minimog.nonce},i.ajax({url:$minimogWoo.wc_ajax_url.toString().replace("%%endpoint%%","minimog_update_product_quantity"),type:"POST",cache:!1,dataType:"json",data:e,success:function(e){i(document.body).trigger("wc_fragment_refresh"),i(document.body).trigger("minimog_update_qty",[t,a])},beforeSend:function(){u()},complete:function(){}})},500))}),r.on("submit",".form-fly-cart-order-notes",n),i(document).on("change","select.shipping_method, :input[name^=shipping_method]",p),i(document).on("submit","form.fly-cart-shipping-calculator",g)}),i(document.body).on("wc_fragments_loaded wc_fragments_refreshed",function(){f(),h(),_(),t.hasClass(e)&&(o.handleLazyImages(r),m())}),i(document.body).on("removed_coupon applied_coupon",h),i(window).on("load",_)}(jQuery);